
#include "game.h"
#include "../fade.h"

typedef struct _peon {
    uint8_t x, y;
    uint8_t state;
} peon;

typedef struct _player {
    peon peons[12];
} player;

typedef struct _gameData {
    uint8_t count;
    uint8_t board[8][8];
    player player[2];
} gameData;

gameData game_data;

// extern const uint8_t tiles;

const uint8_t tiles[192] = {
    0xff,0xff,0xff,0xff,
    0xff,0xff,0xff,0xff,
    0xff,0xff,0xff,0xff,
    0xff,0xff,0xff,0xff,
    0xff,0x00,0xff,0x00,
    0xff,0x00,0xff,0x00,
    0xff,0x00,0xff,0x00,
    0xff,0x00,0xff,0x00,

    0x00,0xff,0x00,0xff,
    0x00,0xff,0x00,0xff,
    0x00,0xff,0x00,0xff,
    0x00,0xff,0x00,0xff,
    0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,

    0x00,0xff,0x00,0xff,
    0x01,0xfe,0x00,0xff,
    0xff,0x00,0x00,0xff,
    0xfe,0x01,0x00,0xff,
    0x05,0xfa,0x05,0xfa,
    0x05,0xfa,0x05,0xfa,
    0x05,0xfa,0x05,0xfa,
    0x05,0xfa,0x05,0xfa,

    0x00,0xff,0x00,0xff,
    0xff,0x00,0x00,0xff,
    0xff,0x00,0x00,0xff,
    0x00,0xff,0x00,0xff,
    0x28,0xd7,0x28,0xd7,
    0x28,0xd7,0x28,0xd7,
    0x28,0xd7,0x28,0xd7,
    0x28,0xd7,0x28,0xd7,

    0x00,0xff,0x00,0xff,
    0x00,0xff,0x00,0xff,
    0x0f,0xf0,0x08,0xf7,
    0x0b,0xf4,0x0a,0xf5,
    0x0a,0xf5,0x0b,0xf4,
    0x08,0xf7,0x0f,0xf0,
    0x00,0xff,0x00,0xff,
    0x00,0xff,0x00,0xff,

    0xff,0x3c,0xc3,0x42,
    0x81,0xbd,0xbd,0x81,
    0xbd,0x81,0xc3,0x81,
    0xff,0x42,0xff,0x3c,
    0xff,0x3c,0xff,0x42,
    0xff,0xbd,0xc3,0xbd,
    0xc3,0xbd,0xbd,0xc3,
    0xc3,0x7e,0xff,0x3c
};

void game_init(void *data) {
    gameData *data_ptr = data;
    data_ptr->count = 0;
    for (uint8_t x = 0; x < 8; x++) {
        for (uint8_t y = 0; y < 8; y++) {
            data_ptr->board[x][y] = 0;
        }
    }

    set_bkg_data(0, 12, tiles);
    HIDE_BKG;
    init_bkg(2);
    for (uint8_t ix = 6; ix < 14; ix++) {
        for (uint8_t iy = 5; iy < 13; iy++) {
            if ((ix + iy) % 2) {
                set_bkg_tile_xy(ix, iy, 3);
            } else {
                if (iy < 8) {
                    set_bkg_tile_xy(ix, iy, 10);
                } else if (iy >= 10) {
                    set_bkg_tile_xy(ix, iy, 11);
                } else {
                    set_bkg_tile_xy(ix, iy, 1);
                }
            }
        }
    }
    SHOW_BKG;
    fade_in();
}

uint8_t game_iter(void *data) {
    gameData *data_ptr = data;
    delay(200);
    return 0;
}

uint8_t game_exit(void *data) {
    gameData *data_ptr = data;
    // fade_out();
    return 1;
}
